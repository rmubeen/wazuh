---
test_name: GET /syscheck/{agent_id}

stages:
  - name: Try to get syscheck scan results for agent 000

    request:
      url: http://localhost:55000/syscheck/000
      method: GET

    response:
      status_code: 200
      body:
        items: !anything
        totalItems: !anyint

#  - name: Try to get syscheck scan results for non-existing agent
#
#    request:
#      url: http://localhost:55000/syscheck/999
#      method: GET
#
#    response:
#      status_code: 1701

  - name: Try to get syscheck scan results for agent 000 with a set limit of answers displayed

    request:
      url: http://localhost:55000/syscheck/000
      method: GET
      params:
        limit: 2

    response:
      status_code: 200
      body:
        #items: [{},{}] # It checks returned body items list only contains 2 dicts
        items[0]:
          date: !anystr
        totalItems: !anyint

  - name: Try to get syscheck scan results for agent 000 using summarize parameter

    request:
      url: http://localhost:55000/syscheck/000
      method: GET
      params:
        summary: True

    response:
      status_code: 200
      body:
        items: !anything
        totalItems: !anyint

---
test_name: GET /syscheck/{agent_id}?select={field}

marks:
  - parametrize:
      key: field
      vals:
        - date
        - mtime
        - file
        - size
        - perm
        - uname
        - gname
        - md5
        - sha1
        - sha256
        - inode
        - gid
        - uid
        - type

stages:
  - name: Try to get syscheck scan results for agent 000 with a selected field answer

    request:
      url: http://localhost:55000/syscheck/000?select={field}
      method: GET

    response:
      status_code: 200
      body:
        items: !anything
        totalItems: !anyint

  - name: Try to get syscheck scan results for agent 000 with a wrong selected field answer

    request:
      url: http://localhost:55000/syscheck/000
      method: GET
      params:
        select: fail

    response:
      status_code: 400
      body:
        code: 1724

---
test_name: GET /syscheck/{agent_id}?sort={field}

marks:
  - parametrize:
      key: field
      vals:
        - date
        - mtime
        - file
        - size
        - perm
        - uname
        - gname
        - md5
        - sha1
        - sha256
        - inode
        - gid
        - uid
        - type

stages:
  - name: Try to get syscheck scan results for agent 000 sorted by field

    request:
      url: http://localhost:55000/syscheck/000?sort={field}
      method: GET

    response:
      status_code: 200
      body:
        items: !anything
        totalItems: !anyint

  - name: Try to get syscheck scan results for agent 000 with a wrong sort field answer

    request:
      url: http://localhost:55000/syscheck/000
      method: GET
      params:
        select: fail

    response:
      status_code: 400
      body:
        code: 1724




---
test_name: PUT /syscheck

stages:
  - name: Try to run a syscheck scan in all agents

    request:
      url: http://localhost:55000/syscheck
      method: PUT

    response:
      status_code: 200
      body:
        message: !anystr

---
